"use strict";(self["webpackChunkMilkSync"]=self["webpackChunkMilkSync"]||[]).push([[997],{5997:function(e,a,l){l.r(a),l.d(a,{default:function(){return P}});l(8111),l(1701);var t=l(641),r=l(33),s=l(3751);const o={key:0,class:"my-4"},n={class:"move-buttons"},i={class:"game-grid"},d={class:"game-title"};function c(e,a,l,c,m,u){const g=(0,t.g2)("v-btn"),f=(0,t.g2)("v-spacer"),p=(0,t.g2)("v-icon"),k=(0,t.g2)("v-card-title"),h=(0,t.g2)("v-text-field"),v=(0,t.g2)("v-img"),y=(0,t.g2)("v-card"),b=(0,t.g2)("v-card-text"),G=(0,t.g2)("v-card-actions"),_=(0,t.g2)("v-dialog"),F=(0,t.g2)("v-select"),C=(0,t.g2)("GameSection"),P=(0,t.g2)("v-row"),w=(0,t.g2)("v-snackbar"),M=(0,t.g2)("v-container");return(0,t.uX)(),(0,t.Wv)(M,{class:"py-6"},{default:(0,t.k6)(()=>[a[45]||(a[45]=(0,t.Lk)("h2",{class:"mb-6"},"MilkSync Game Tracker",-1)),(0,t.bF)(g,{color:"primary",onClick:a[0]||(a[0]=e=>m.searchDialog=!0)},{default:(0,t.k6)(()=>[...a[24]||(a[24]=[(0,t.eW)("🔍 Search Games",-1)])]),_:1}),(0,t.bF)(g,{color:"secondary",class:"ml-2",onClick:a[1]||(a[1]=e=>m.editMode=!m.editMode)},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)(m.editMode?"Exit Edit Mode":"Edit Games"),1)]),_:1}),m.editMode&&m.selectedGames.length?((0,t.uX)(),(0,t.CE)("div",o,[(0,t.bF)(g,{color:"error",onClick:u.bulkDelete},{default:(0,t.k6)(()=>[...a[25]||(a[25]=[(0,t.eW)("Delete Selected",-1)])]),_:1},8,["onClick"]),(0,t.Lk)("div",n,[(0,t.bF)(g,{color:"success",onClick:a[2]||(a[2]=e=>u.bulkMove("completed"))},{default:(0,t.k6)(()=>[...a[26]||(a[26]=[(0,t.eW)("Move to Completed",-1)])]),_:1}),(0,t.bF)(g,{color:"info",onClick:a[3]||(a[3]=e=>u.bulkMove("inProgress"))},{default:(0,t.k6)(()=>[...a[27]||(a[27]=[(0,t.eW)("Move to In Progress",-1)])]),_:1}),(0,t.bF)(g,{color:"warning",onClick:a[4]||(a[4]=e=>u.bulkMove("planned"))},{default:(0,t.k6)(()=>[...a[28]||(a[28]=[(0,t.eW)("Move to Planned",-1)])]),_:1})])])):(0,t.Q3)("",!0),(0,t.bF)(_,{modelValue:m.searchDialog,"onUpdate:modelValue":a[11]||(a[11]=e=>m.searchDialog=e),"max-width":"1100px"},{default:(0,t.k6)(()=>[(0,t.bF)(y,null,{default:(0,t.k6)(()=>[(0,t.bF)(k,null,{default:(0,t.k6)(()=>[a[30]||(a[30]=(0,t.Lk)("span",{class:"text-h6"},"Search Games",-1)),(0,t.bF)(f),(0,t.bF)(g,{icon:"",onClick:a[5]||(a[5]=e=>m.searchDialog=!1)},{default:(0,t.k6)(()=>[(0,t.bF)(p,null,{default:(0,t.k6)(()=>[...a[29]||(a[29]=[(0,t.eW)("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),(0,t.bF)(b,{style:{"max-height":"80vh","overflow-y":"auto"}},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:m.searchQuery,"onUpdate:modelValue":a[6]||(a[6]=e=>m.searchQuery=e),label:"Search games","prepend-icon":"mdi-magnify",onKeyup:(0,s.jR)(u.searchGames,["enter"]),clearable:""},null,8,["modelValue","onKeyup"]),(0,t.Lk)("div",i,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(m.searchResults,e=>((0,t.uX)(),(0,t.Wv)(y,{key:e.id,class:(0,r.C4)(["game-card",{selected:m.selectedGames.includes(e.id)}]),onClick:a=>u.toggleGameSelection(e)},{default:(0,t.k6)(()=>[(0,t.bF)(v,{src:e.background_image,height:"240px",cover:""},null,8,["src"]),(0,t.Lk)("div",d,(0,r.v_)(e.name||"Untitled Game"),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1}),(0,t.bF)(G,{class:"justify-space-between"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",null,[(0,t.bF)(g,{color:"success",onClick:a[7]||(a[7]=e=>u.saveGameToCategory("completed")),disabled:0===m.selectedGames.length},{default:(0,t.k6)(()=>[...a[31]||(a[31]=[(0,t.eW)("Add to Completed",-1)])]),_:1},8,["disabled"]),(0,t.bF)(g,{color:"info",onClick:a[8]||(a[8]=e=>u.saveGameToCategory("inProgress")),disabled:0===m.selectedGames.length},{default:(0,t.k6)(()=>[...a[32]||(a[32]=[(0,t.eW)("Add to In Progress",-1)])]),_:1},8,["disabled"]),(0,t.bF)(g,{color:"warning",onClick:a[9]||(a[9]=e=>u.saveGameToCategory("planned")),disabled:0===m.selectedGames.length},{default:(0,t.k6)(()=>[...a[33]||(a[33]=[(0,t.eW)("Add to Planned",-1)])]),_:1},8,["disabled"])]),(0,t.bF)(f),(0,t.bF)(g,{text:"",onClick:a[10]||(a[10]=e=>m.searchDialog=!1)},{default:(0,t.k6)(()=>[...a[34]||(a[34]=[(0,t.eW)("Done",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,t.bF)(_,{modelValue:m.playerDialog,"onUpdate:modelValue":a[14]||(a[14]=e=>m.playerDialog=e),"max-width":"500px"},{default:(0,t.k6)(()=>[(0,t.bF)(y,null,{default:(0,t.k6)(()=>[(0,t.bF)(k,null,{default:(0,t.k6)(()=>[...a[35]||(a[35]=[(0,t.eW)("Select Players",-1)])]),_:1}),(0,t.bF)(b,null,{default:(0,t.k6)(()=>[(0,t.bF)(F,{modelValue:m.selectedPlayers,"onUpdate:modelValue":a[12]||(a[12]=e=>m.selectedPlayers=e),items:m.allUsernames,"item-title":"username","item-value":"id",label:"Who will be playing?",multiple:"",chips:""},null,8,["modelValue","items"])]),_:1}),(0,t.bF)(G,null,{default:(0,t.k6)(()=>[(0,t.bF)(g,{color:"primary",onClick:u.confirmGameAssignment},{default:(0,t.k6)(()=>[...a[36]||(a[36]=[(0,t.eW)("Confirm",-1)])]),_:1},8,["onClick"]),(0,t.bF)(g,{text:"",onClick:a[13]||(a[13]=e=>m.playerDialog=!1)},{default:(0,t.k6)(()=>[...a[37]||(a[37]=[(0,t.eW)("Cancel",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,t.bF)(_,{modelValue:m.gameInfoDialog,"onUpdate:modelValue":a[16]||(a[16]=e=>m.gameInfoDialog=e),"max-width":"600px"},{default:(0,t.k6)(()=>[m.selectedGame?((0,t.uX)(),(0,t.Wv)(y,{key:0},{default:(0,t.k6)(()=>[(0,t.bF)(v,{src:m.selectedGame.background_image||m.selectedGame.image_url,height:"240px",cover:""},null,8,["src"]),(0,t.bF)(k,null,{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)(m.selectedGame.name),1)]),_:1}),(0,t.bF)(b,null,{default:(0,t.k6)(()=>[(0,t.Lk)("p",null,[a[38]||(a[38]=(0,t.Lk)("strong",null,"Platforms:",-1)),(0,t.eW)(" "+(0,r.v_)(u.formatPlatforms(m.selectedGame.platforms)),1)]),(0,t.Lk)("p",null,[a[39]||(a[39]=(0,t.Lk)("strong",null,"Rating:",-1)),(0,t.eW)(" "+(0,r.v_)(m.selectedGame.rating||"Unrated"),1)]),(0,t.Lk)("p",null,[a[40]||(a[40]=(0,t.Lk)("strong",null,"Genre:",-1)),(0,t.eW)(" "+(0,r.v_)(m.selectedGame.genres?.map(e=>e.name).join(", ")||"N/A"),1)]),(0,t.Lk)("p",null,[a[41]||(a[41]=(0,t.Lk)("strong",null,"Release Date:",-1)),(0,t.eW)(" "+(0,r.v_)(m.selectedGame.released||"Unknown"),1)]),(0,t.Lk)("p",null,[a[42]||(a[42]=(0,t.Lk)("strong",null,"Developer:",-1)),(0,t.eW)(" "+(0,r.v_)(m.selectedGame.developers?.map(e=>e.name).join(", ")||"N/A"),1)])]),_:1}),(0,t.bF)(G,null,{default:(0,t.k6)(()=>[(0,t.bF)(f),(0,t.bF)(g,{text:"",onClick:a[15]||(a[15]=e=>m.gameInfoDialog=!1)},{default:(0,t.k6)(()=>[...a[43]||(a[43]=[(0,t.eW)("Close",-1)])]),_:1})]),_:1})]),_:1})):(0,t.Q3)("",!0)]),_:1},8,["modelValue"]),(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)(C,{title:"✅ Completed",category:"completed",games:m.completedGames,selectedGames:m.selectedGames,editMode:m.editMode,onRemove:a[17]||(a[17]=e=>u.deleteGame("completed",e)),onMove:u.moveGame,onInfo:a[18]||(a[18]=e=>m.editMode?u.toggleGameSelection(e):u.openGameInfo(e)),onEditPlayers:u.openPlayerEditor},null,8,["games","selectedGames","editMode","onMove","onEditPlayers"]),(0,t.bF)(C,{title:"⏳ In Progress",category:"inProgress",games:m.inProgressGames,selectedGames:m.selectedGames,editMode:m.editMode,onRemove:a[19]||(a[19]=e=>u.deleteGame("inProgress",e)),onMove:u.moveGame,onInfo:a[20]||(a[20]=e=>m.editMode?u.toggleGameSelection(e):u.openGameInfo(e)),onEditPlayers:u.openPlayerEditor},null,8,["games","selectedGames","editMode","onMove","onEditPlayers"]),(0,t.bF)(C,{title:"📝 Planned",category:"planned",games:m.plannedGames,selectedGames:m.selectedGames,editMode:m.editMode,onRemove:a[21]||(a[21]=e=>u.deleteGame("planned",e)),onMove:u.moveGame,onInfo:a[22]||(a[22]=e=>m.editMode?u.toggleGameSelection(e):u.openGameInfo(e)),onEditPlayers:u.openPlayerEditor},null,8,["games","selectedGames","editMode","onMove","onEditPlayers"])]),_:1}),(0,t.bF)(w,{modelValue:m.errorSnackbar,"onUpdate:modelValue":a[23]||(a[23]=e=>m.errorSnackbar=e),color:"error"},{default:(0,t.k6)(()=>[...a[44]||(a[44]=[(0,t.eW)(" ❌ Something went wrong ",-1)])]),_:1},8,["modelValue"])]),_:1})}l(4114),l(2489);var m=l(3741);const u={class:"mb-4"},g={class:"game-grid"},f={class:"game-title"},p={key:0,class:"avatar-row"},k=["title"],h=["src","alt"];function v(e,a,l,o,n,i){const d=(0,t.g2)("v-img"),c=(0,t.g2)("v-icon"),m=(0,t.g2)("v-btn"),v=(0,t.g2)("v-list-item-title"),y=(0,t.g2)("v-list-item"),b=(0,t.g2)("v-divider"),G=(0,t.g2)("v-list"),_=(0,t.g2)("v-menu"),F=(0,t.g2)("v-card-actions"),C=(0,t.g2)("v-card"),P=(0,t.g2)("v-col");return(0,t.uX)(),(0,t.Wv)(P,{cols:"12"},{default:(0,t.k6)(()=>[(0,t.Lk)("h3",u,(0,r.v_)(l.title),1),(0,t.Lk)("div",g,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(l.games,o=>((0,t.uX)(),(0,t.Wv)(C,{key:o.id||o.rawg_id,class:(0,r.C4)(["game-card",{selected:l.selectedGames.includes(o.id)}]),onClick:e=>i.handleClick(o)},{default:(0,t.k6)(()=>[(0,t.bF)(d,{src:o.image_url||o.background_image,height:"240px",cover:"",class:"rounded-t-xl"},null,8,["src"]),(0,t.Lk)("div",f,(0,r.v_)(o.name||"Untitled Game"),1),i.getPlayerProfiles(o).length?((0,t.uX)(),(0,t.CE)("div",p,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(i.getPlayerProfiles(o),e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"avatar-wrapper",title:e.username},[(0,t.Lk)("img",{src:e.avatar_url?.trim()||n.defaultAvatarUrl,alt:e.username,class:"avatar"},null,8,h)],8,k))),128))])):(0,t.Q3)("",!0),l.editMode?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(F,{key:1,class:"justify-center"},{default:(0,t.k6)(()=>[(0,t.bF)(_,{"offset-y":""},{activator:(0,t.k6)(({props:e})=>[(0,t.bF)(m,(0,t.v6)({icon:""},{ref_for:!0},e,{class:"menu-btn"}),{default:(0,t.k6)(()=>[(0,t.bF)(c,null,{default:(0,t.k6)(()=>[...a[0]||(a[0]=[(0,t.eW)("mdi-dots-vertical",-1)])]),_:1})]),_:1},16)]),default:(0,t.k6)(()=>[(0,t.bF)(G,null,{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(i.moveOptions,a=>((0,t.uX)(),(0,t.Wv)(y,{key:a,onClick:(0,s.D$)(l=>e.$emit("move",{game:o,newCategory:a}),["stop"])},{default:(0,t.k6)(()=>[(0,t.bF)(v,null,{default:(0,t.k6)(()=>[(0,t.eW)("Move to "+(0,r.v_)(i.formatLabel(a)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(0,t.bF)(b),(0,t.bF)(y,{onClick:(0,s.D$)(a=>e.$emit("editPlayers",o),["stop"])},{default:(0,t.k6)(()=>[(0,t.bF)(v,null,{default:(0,t.k6)(()=>[...a[1]||(a[1]=[(0,t.eW)("Edit Players",-1)])]),_:1})]),_:1},8,["onClick"]),(0,t.bF)(y,{onClick:(0,s.D$)(a=>e.$emit("remove",o),["stop"])},{default:(0,t.k6)(()=>[(0,t.bF)(v,{class:"text-error"},{default:(0,t.k6)(()=>[...a[2]||(a[2]=[(0,t.eW)("Delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1032,["class","onClick"]))),128))])]),_:1})}var y={name:"GameSection",props:{title:String,category:String,games:{type:Array,default:()=>[]},selectedGames:{type:Array,default:()=>[]},editMode:{type:Boolean,default:!1}},data(){return{defaultAvatarUrl:""}},computed:{moveOptions(){return["completed","inProgress","planned"].filter(e=>e!==this.category)}},async mounted(){const{data:e}=m.N.storage.from("avatars").getPublicUrl("default-avatar.jpg");e?.publicUrl?this.defaultAvatarUrl=e.publicUrl:console.warn("⚠️ Default avatar URL not found in Supabase Storage")},methods:{formatLabel(e){return{completed:"✅ Completed",inProgress:"⏳ In Progress",planned:"📝 Planned"}[e]||e},handleClick(e){this.$emit("info",e)},getPlayerProfiles(e){return Array.isArray(e.game_players)?e.game_players.map(e=>e.profile).filter(Boolean):[]}}},b=l(6262);const G=(0,b.A)(y,[["render",v],["__scopeId","data-v-20a649a8"]]);var _=G,F={name:"GamesPage",components:{GameSection:_},data(){return{searchQuery:"",searchResults:[],selectedGames:[],completedGames:[],inProgressGames:[],plannedGames:[],searchDialog:!1,gameInfoDialog:!1,playerDialog:!1,selectedGame:null,errorSnackbar:!1,editMode:!1,allUsernames:[],selectedPlayers:[],pendingCategory:"",editingGameId:null}},async mounted(){await this.fetchGames();const{data:e,error:a}=await m.N.from("profiles").select("id, username, avatar_url");a?console.error("Failed to fetch usernames:",a.message):this.allUsernames=e},methods:{async searchGames(){const e="243d6955b70b401092f7169e2badd60b";try{const a=await fetch(`https://api.rawg.io/api/games?key=${e}&search=${encodeURIComponent(this.searchQuery)}`),l=await a.json();this.searchResults=l.results||[]}catch(a){console.error("RAWG search error:",a),this.errorSnackbar=!0}},toggleGameSelection(e){const a=this.selectedGames.indexOf(e.id);-1===a?this.selectedGames.push(e.id):this.selectedGames.splice(a,1)},async saveGameToCategory(e){this.selectedGames.length&&(this.pendingCategory=e,this.playerDialog=!0)},openPlayerEditor(e){this.editingGameId=e.id,this.selectedPlayers=Array.isArray(e.game_players)?e.game_players.map(e=>e.profile?.id).filter(Boolean):[],this.playerDialog=!0},async confirmGameAssignment(){if(this.editingGameId){await m.N.from("game_players").delete().eq("game_id",this.editingGameId);const e=this.selectedPlayers.map(e=>({game_id:this.editingGameId,profile_id:e})),{error:a}=await m.N.from("game_players").insert(e);a&&(console.error("Player update error:",a.message),this.errorSnackbar=!0),this.editingGameId=null}else{const e=this.searchResults.filter(e=>this.selectedGames.includes(e.id));for(const a of e){const{data:e,error:l}=await m.N.from("games").insert({rawg_id:a.id,name:a.name,image_url:a.background_image||"",platforms:Array.isArray(a.platforms)?a.platforms.map(e=>e.platform.name):[],category:this.pendingCategory}).select().single();if(l){console.error("Supabase insert error:",l.message),this.errorSnackbar=!0;continue}const t=this.selectedPlayers.map(a=>({game_id:e.id,profile_id:a})),{error:r}=await m.N.from("game_players").insert(t);r&&(console.error("Player assignment error:",r.message),this.errorSnackbar=!0)}}this.selectedGames=[],this.selectedPlayers=[],this.playerDialog=!1,await this.fetchGames()},async fetchGames(){const{data:e,error:a}=await m.N.from("games").select("\n          *,\n          game_players (\n            profile:profiles(id, username, avatar_url)\n          )\n        ");if(a)return console.error("Supabase fetch error:",a.message),void(this.errorSnackbar=!0);this.completedGames=e.filter(e=>"completed"===e.category),this.inProgressGames=e.filter(e=>"inProgress"===e.category),this.plannedGames=e.filter(e=>"planned"===e.category)},async deleteGame(e,a){if(!a?.id)return console.error("Delete failed: game object missing or invalid"),void(this.errorSnackbar=!0);const{error:l}=await m.N.from("games").delete().eq("id",a.id);l?(console.error("Supabase delete error:",l.message),this.errorSnackbar=!0):await this.fetchGames()},async moveGame({game:e,newCategory:a}){const{error:l}=await m.N.from("games").update({category:a}).eq("id",e.id);l?(console.error("Supabase move error:",l.message),this.errorSnackbar=!0):await this.fetchGames()},async bulkDelete(){if(!confirm("Delete selected games?"))return;const{error:e}=await m.N.from("games").delete().in("id",this.selectedGames);e?(console.error("Bulk delete error:",e.message),this.errorSnackbar=!0):(this.selectedGames=[],this.editMode=!1,await this.fetchGames())},async bulkMove(e){const{error:a}=await m.N.from("games").update({category:e}).in("id",this.selectedGames);a?(console.error("Bulk move error:",a.message),this.errorSnackbar=!0):(this.selectedGames=[],this.editMode=!1,await this.fetchGames())},async openGameInfo(e){const a="243d6955b70b401092f7169e2badd60b";try{const l=await fetch(`https://api.rawg.io/api/games/${e.rawg_id||e.id}?key=${a}`),t=await l.json();this.selectedGame=t}catch(l){console.error("RAWG detail fetch error:",l),this.selectedGame=e}this.gameInfoDialog=!0},formatPlatforms(e){return Array.isArray(e)?e.map(e=>e.platform?.name||e).join(", "):e||"N/A"}}};const C=(0,b.A)(F,[["render",c],["__scopeId","data-v-103aecb2"]]);var P=C}}]);
//# sourceMappingURL=997.6c1923f2.js.map