(function(){"use strict";var e={3741:function(e,a,t){t.d(a,{N:function(){return i}});var l=t(991);const s="https://heuigzyutypfjpqzipik.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhldWlnenl1dHlwZmpwcXppcGlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0MjA3MTYsImV4cCI6MjA3Mzk5NjcxNn0.DF8fjinfbOSiP6SjWlxo991auPxerIFjr-UicrRys88",i=(0,l.UU)(s,r)},8867:function(e,a,t){var l=t(3751),s=t(641);const r={id:"app",class:"app-wrapper"},i={class:"nav-bar"};function o(e,a,t,l,o,n){const u=(0,s.g2)("router-link"),d=(0,s.g2)("v-spacer"),c=(0,s.g2)("v-btn"),m=(0,s.g2)("LoginPopup"),p=(0,s.g2)("v-dialog"),v=(0,s.g2)("SignUpPopup"),h=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",r,[a[12]||(a[12]=(0,s.Fv)('<img src="/milk-splash.svg" alt="Milk splash" class="milk-splash splash-top-left" data-v-6471c57b><img src="/milk-splash.svg" alt="Milk splash" class="milk-splash splash-bottom-right" data-v-6471c57b><div class="blob-layer" data-v-6471c57b><img src="/=blob1.svg" class="blob blob1" alt="Blob 1" data-v-6471c57b><img src="/blob2.svg" class="blob blob2" alt="Blob 2" data-v-6471c57b><img src="/blob3.svg" class="blob blob3" alt="Blob 3" data-v-6471c57b><img src="/blob4.svg" class="blob blob4" alt="Blob 4" data-v-6471c57b></div>',3)),(0,s.Lk)("header",i,[(0,s.Lk)("nav",null,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>n.goHome&&n.goHome(...e)),class:"nav-link"},"Home"),(0,s.bF)(u,{to:"/calendar",class:"nav-link"},{default:(0,s.k6)(()=>[...a[8]||(a[8]=[(0,s.eW)("Calendar",-1)])]),_:1}),(0,s.bF)(u,{to:"/games",class:"nav-link"},{default:(0,s.k6)(()=>[...a[9]||(a[9]=[(0,s.eW)("Games",-1)])]),_:1}),(0,s.bF)(d),o.isLoggedIn?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.bF)(c,{text:"",onClick:a[1]||(a[1]=e=>o.showLogin=!0),class:"nav-link"},{default:(0,s.k6)(()=>[...a[10]||(a[10]=[(0,s.eW)("Log In",-1)])]),_:1}),(0,s.bF)(c,{text:"",onClick:a[2]||(a[2]=e=>o.showSignup=!0),class:"nav-link"},{default:(0,s.k6)(()=>[...a[11]||(a[11]=[(0,s.eW)("Sign Up",-1)])]),_:1})],64)),o.isLoggedIn?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"sign-out-button",onClick:a[3]||(a[3]=(...e)=>n.signOut&&n.signOut(...e))}," Sign Out ")):(0,s.Q3)("",!0)]),(0,s.bF)(p,{modelValue:o.showLogin,"onUpdate:modelValue":a[5]||(a[5]=e=>o.showLogin=e),"max-width":"400"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{onClose:a[4]||(a[4]=e=>o.showLogin=!1),onLoggedIn:n.handleLogin},null,8,["onLoggedIn"])]),_:1},8,["modelValue"]),(0,s.bF)(p,{modelValue:o.showSignup,"onUpdate:modelValue":a[7]||(a[7]=e=>o.showSignup=e),"max-width":"400"},{default:(0,s.k6)(()=>[(0,s.bF)(v,{onClose:a[6]||(a[6]=e=>o.showSignup=!1),onSignedUp:n.handleLogin},null,8,["onSignedUp"])]),_:1},8,["modelValue"])]),(0,s.Lk)("main",null,[(0,s.bF)(h)])])}t(4114);var n=t(3741),u=t(33);function d(e,a,t,l,r,i){const o=(0,s.g2)("v-card-title"),n=(0,s.g2)("v-text-field"),d=(0,s.g2)("v-btn"),c=(0,s.g2)("v-alert"),m=(0,s.g2)("v-card");return(0,s.uX)(),(0,s.Wv)(m,{class:"pa-6"},{default:(0,s.k6)(()=>[(0,s.bF)(o,{class:"text-h5"},{default:(0,s.k6)(()=>[...a[3]||(a[3]=[(0,s.eW)("Log In",-1)])]),_:1}),(0,s.bF)(n,{label:"Email",modelValue:r.email,"onUpdate:modelValue":a[0]||(a[0]=e=>r.email=e),class:"mt-4"},null,8,["modelValue"]),(0,s.bF)(n,{label:"Password",modelValue:r.password,"onUpdate:modelValue":a[1]||(a[1]=e=>r.password=e),type:"password",class:"mt-2"},null,8,["modelValue"]),(0,s.bF)(d,{onClick:i.logIn,color:"primary",class:"mt-4"},{default:(0,s.k6)(()=>[...a[4]||(a[4]=[(0,s.eW)("Log In",-1)])]),_:1},8,["onClick"]),(0,s.bF)(d,{text:"",onClick:a[2]||(a[2]=a=>e.$emit("close")),class:"mt-2"},{default:(0,s.k6)(()=>[...a[5]||(a[5]=[(0,s.eW)("Cancel",-1)])]),_:1}),r.errorMessage?((0,s.uX)(),(0,s.Wv)(c,{key:0,type:"error",class:"mt-4"},{default:(0,s.k6)(()=>[(0,s.eW)((0,u.v_)(r.errorMessage),1)]),_:1})):(0,s.Q3)("",!0)]),_:1})}var c={name:"LoginPopup",data(){return{email:"",password:"",errorMessage:""}},methods:{async logIn(){const{error:e}=await n.N.auth.signInWithPassword({email:this.email,password:this.password});e?this.errorMessage=e.message:this.$emit("logged-in")}}},m=t(6262);const p=(0,m.A)(c,[["render",d]]);var v=p;function h(e,a,t,l,r,i){const o=(0,s.g2)("v-card-title"),n=(0,s.g2)("v-text-field"),d=(0,s.g2)("v-btn"),c=(0,s.g2)("v-alert"),m=(0,s.g2)("v-snackbar"),p=(0,s.g2)("v-card");return(0,s.uX)(),(0,s.Wv)(p,{class:"pa-6"},{default:(0,s.k6)(()=>[(0,s.bF)(o,{class:"text-h5"},{default:(0,s.k6)(()=>[...a[5]||(a[5]=[(0,s.eW)("Create Account",-1)])]),_:1}),(0,s.bF)(n,{label:"Email",modelValue:r.email,"onUpdate:modelValue":a[0]||(a[0]=e=>r.email=e),class:"mt-4"},null,8,["modelValue"]),(0,s.bF)(n,{label:"Username",modelValue:r.username,"onUpdate:modelValue":a[1]||(a[1]=e=>r.username=e),class:"mt-2"},null,8,["modelValue"]),(0,s.bF)(n,{label:"Password",modelValue:r.password,"onUpdate:modelValue":a[2]||(a[2]=e=>r.password=e),type:"password",class:"mt-2"},null,8,["modelValue"]),(0,s.bF)(d,{onClick:i.signUp,color:"primary",class:"mt-4"},{default:(0,s.k6)(()=>[...a[6]||(a[6]=[(0,s.eW)("Sign Up",-1)])]),_:1},8,["onClick"]),(0,s.bF)(d,{text:"",onClick:a[3]||(a[3]=a=>e.$emit("close")),class:"mt-2"},{default:(0,s.k6)(()=>[...a[7]||(a[7]=[(0,s.eW)("Cancel",-1)])]),_:1}),r.errorMessage?((0,s.uX)(),(0,s.Wv)(c,{key:0,type:"error",class:"mt-4"},{default:(0,s.k6)(()=>[(0,s.eW)((0,u.v_)(r.errorMessage),1)]),_:1})):(0,s.Q3)("",!0),(0,s.bF)(m,{modelValue:r.showToast,"onUpdate:modelValue":a[4]||(a[4]=e=>r.showToast=e),color:"success",timeout:"4000"},{default:(0,s.k6)(()=>[(0,s.eW)(" Welcome, "+(0,u.v_)(r.username)+"! You’ve been added to the calendar 🎉 ",1)]),_:1},8,["modelValue"])]),_:1})}var b={name:"SignUpPopup",data(){return{email:"",username:"",password:"",errorMessage:"",showToast:!1}},methods:{async signUp(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone,{data:a,error:t}=await n.N.auth.signUp({email:this.email,password:this.password});if(t)return void(this.errorMessage=t.message);const l=a.user.id,{error:s}=await n.N.from("profiles").insert({id:l,email:this.email,username:this.username,timezone:e});if(s)return void(this.errorMessage=s.message);const r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],i=r.map(e=>({user_id:l,username:this.username,day:e,start_time:"00:00",end_time:"00:00"})),{error:o}=await n.N.from("availability").insert(i);o?this.errorMessage=o.message:(this.showToast=!0,setTimeout(()=>this.$emit("signed-up"),1e3))}}};const f=(0,m.A)(b,[["render",h]]);var g=f,y={name:"App",components:{LoginPopup:v,SignUpPopup:g},data(){return{isLoggedIn:!1,showLogin:!1,showSignup:!1}},async mounted(){const{data:{user:e}}=await n.N.auth.getUser();this.isLoggedIn=!!e,e&&"/dashboard"!==this.$route.path&&this.$router.push("/dashboard")},methods:{goHome(){this.isLoggedIn?this.$router.push("/dashboard"):this.$router.push("/")},async signOut(){const{error:e}=await n.N.auth.signOut();e?console.error("Sign out failed:",e.message):(this.isLoggedIn=!1,this.$router.push("/"))},handleLogin(){this.isLoggedIn=!0,this.showLogin=!1,this.showSignup=!1,this.$router.push("/dashboard")}}};const k=(0,m.A)(y,[["render",o],["__scopeId","data-v-6471c57b"]]);var w=k,U=t(5220);const C={class:"avatar-grid"},_=["title"],F=["src","alt"],A={class:"avatar-label"};function L(e,a,t,l,r,i){const o=(0,s.g2)("v-col"),n=(0,s.g2)("v-row"),d=(0,s.g2)("v-container");return(0,s.uX)(),(0,s.Wv)(d,{class:"home-wrapper"},{default:(0,s.k6)(()=>[(0,s.bF)(n,{justify:"center",align:"center"},{default:(0,s.k6)(()=>[(0,s.bF)(o,{cols:"12",md:"8",class:"text-center"},{default:(0,s.k6)(()=>[...a[0]||(a[0]=[(0,s.Lk)("div",{class:"hero-box"},[(0,s.Lk)("h1",{class:"hero-title"},[(0,s.eW)("Welcome to "),(0,s.Lk)("span",{class:"milk"},"MilkSync")]),(0,s.Lk)("p",{class:"hero-subtitle"}," I have slaved away at this for too long... ")],-1)])]),_:1})]),_:1}),(0,s.bF)(n,{justify:"center",class:"avatar-row"},{default:(0,s.k6)(()=>[(0,s.bF)(o,{cols:"12",md:"10"},{default:(0,s.k6)(()=>[a[1]||(a[1]=(0,s.Lk)("h2",{class:"avatar-title"},"Users",-1)),(0,s.Lk)("div",C,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.allUsernames,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"avatar-wrapper",title:e.username},[(0,s.Lk)("img",{src:e.avatar_url?.trim()||r.defaultAvatarUrl,alt:e.username,class:"avatar"},null,8,F),(0,s.Lk)("div",A,(0,u.v_)(e.username),1)],8,_))),128))])]),_:1})]),_:1})]),_:1})}var I={name:"HomePage",data(){return{allUsernames:[],defaultAvatarUrl:""}},async mounted(){const{data:e,error:a}=await n.N.from("profiles").select("id, username, avatar_url");a?console.error("Failed to fetch user avatars:",a.message):this.allUsernames=e;const{data:t}=n.N.storage.from("avatars").getPublicUrl("default-avatar.jpg");this.defaultAvatarUrl=t?.publicUrl||""}};const S=(0,m.A)(I,[["render",L],["__scopeId","data-v-184679d9"]]);var T=S;t(8111),t(2489);const N={class:"filter-controls"},W={class:"filter"},M=["value"],V={class:"calendar"},E={class:"grid"},O={class:"name"};function x(e,a,t,r,i,o){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",N,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>o.selectAll&&o.selectAll(...e)),class:"toggle-btn"},"Select All"),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>o.clearAll&&o.clearAll(...e)),class:"toggle-btn danger"},"Clear All")]),(0,s.Lk)("div",W,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.allNames,e=>((0,s.uX)(),(0,s.CE)("label",{key:e},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:e,"onUpdate:modelValue":a[2]||(a[2]=e=>i.visibleNames=e)},null,8,M),[[l.lH,i.visibleNames]]),(0,s.eW)(" "+(0,u.v_)(e),1)]))),128))]),(0,s.Lk)("div",V,[a[4]||(a[4]=(0,s.Lk)("h1",null,"🗓️ Weekly Calendar",-1)),(0,s.Lk)("div",E,[a[3]||(a[3]=(0,s.Lk)("div",{class:"corner"},"Name",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.daysOfWeek,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"header"},(0,u.v_)(e),1))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.sheetData.filter(e=>i.visibleNames.includes(e[0])),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"row"},[(0,s.Lk)("div",O,(0,u.v_)(e[0]),1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.slice(1),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,u.C4)(["cell",o.getCellClass(e)])},(0,u.v_)(e),3))),128))]))),128))])])],64)}t(7588),t(1701),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);var j={name:"CalendarPage",data(){return{sheetData:[],daysOfWeek:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],allNames:[],visibleNames:[],timeSlots:[],currentUserName:"",userTimeZone:""}},methods:{getCellClass(e){return!e||e.toLowerCase().includes("tbd")?"tbd":e.toLowerCase().includes("unavailable")?"unavailable":"available"},selectAll(){this.visibleNames=[...this.allNames]},clearAll(){this.visibleNames=[]},formatUtcToLocal(e){if(!e||"string"!==typeof e||!/^\d{2}:\d{2}(:\d{2})?$/.test(e))return"";const a=(new Date).toISOString().split("T")[0],t=new Date(`${a}T${e}Z`);return isNaN(t.getTime())?"":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:this.userTimeZone||Intl.DateTimeFormat().resolvedOptions().timeZone})},generateTimeSlots(){const e=new Date("2025-09-22T12:00:00-04:00"),a=[];for(let t=12;t<=23;t++){const l=new Date(e);l.setHours(t,0,0,0),a.push(l.toISOString().replace("Z","-04:00"))}this.timeSlots=a},async fetchAvailability(){const{data:e,error:a}=await n.N.from("availability").select("*");a?console.error("Supabase fetch error:",a):(this.sheetData=this.reshapeData(e),this.allNames=[...new Set(e.map(e=>e.username))],this.visibleNames=[...this.allNames])},reshapeData(e){const a={};return e.forEach(e=>{a[e.username]||(a[e.username]={name:e.username});const t=this.formatUtcToLocal(e.start_time),l=this.formatUtcToLocal(e.end_time);let s;s="Available"===e.status?t&&l?`${t}–${l}`:"TBD":e.status,a[e.username][e.day]=s}),Object.values(a).map(e=>[e.name,...this.daysOfWeek.map(a=>e[a]||"")])},listenForUpdates(){n.N.channel("availability-updates").on("postgres_changes",{event:"*",schema:"public",table:"availability"},e=>{console.log("Realtime update:",e),this.fetchAvailability()}).subscribe()},isEditable(e){return e===this.currentUserName},async updateAvailability(e,a,t){let l=t,s=null,r=null;t.includes("–")?([s,r]=t.split("–").map(e=>e.trim()),l="Available"):["TBD","Unavailable"].includes(t)&&(l=t);const{data:i,error:o}=await n.N.from("availability").upsert({username:e,day:a,start_time:s,end_time:r,status:l},{onConflict:["username","day"]});o?console.error("Update failed:",o):console.log("Availability updated:",i)},async fetchUsername(e){const{data:a}=await n.N.from("profiles").select("username, timezone").eq("id",e).single();a?(this.currentUserName=a.username,this.userTimeZone=a.timezone):console.warn("Username not found for user:",e)}},async mounted(){this.generateTimeSlots(),this.fetchAvailability(),this.listenForUpdates();const{data:{user:e}}=await n.N.auth.getUser();e&&this.fetchUsername(e.id)}};const X=(0,m.A)(j,[["render",x],["__scopeId","data-v-a1901492"]]);var D=X;const $={class:"dashboard-flex"},P={class:"avatar-box"},Z={class:"greeting-box"},z={class:"milk-heading"},B={class:"avatar-splash-wrapper"},J=["src"],H={class:"availability-box"},R={class:"day-label"},q={class:"time-range"},K={key:1,class:"tbd-badge"},Q={key:2,class:"unavailable-text"},Y={class:"toggle-box"},G={class:"action-row"};function ee(e,a,t,l,r,i){const o=(0,s.g2)("v-avatar"),n=(0,s.g2)("v-btn"),d=(0,s.g2)("v-card"),c=(0,s.g2)("v-text-field"),m=(0,s.g2)("v-col"),p=(0,s.g2)("v-row"),v=(0,s.g2)("v-switch"),h=(0,s.g2)("v-snackbar"),b=(0,s.g2)("v-card-title"),f=(0,s.g2)("AvatarEditor"),g=(0,s.g2)("v-card-text"),y=(0,s.g2)("v-spacer"),k=(0,s.g2)("v-card-actions"),w=(0,s.g2)("v-dialog"),U=(0,s.g2)("v-container");return(0,s.uX)(),(0,s.Wv)(U,{class:"dashboard-container"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{class:"dashboard-card"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",$,[(0,s.Lk)("div",P,[(0,s.Lk)("div",Z,[(0,s.Lk)("h2",z,"Hi, "+(0,u.v_)(r.profile.username)+"! 👋",1),a[4]||(a[4]=(0,s.Lk)("p",{class:"milk-subtitle"},"Welcome back to your dashboard",-1))]),(0,s.Lk)("div",B,[a[6]||(a[6]=(0,s.Lk)("img",{src:"/milk-splash.svg",class:"milk-splash",alt:"Milk splash"},null,-1)),(0,s.bF)(d,{class:"avatar-card"},{default:(0,s.k6)(()=>[(0,s.bF)(o,{size:200,class:"avatar-wrapper"},{default:(0,s.k6)(()=>[(0,s.Lk)("img",{src:r.avatarUrl||r.defaultAvatar,alt:"User avatar"},null,8,J)]),_:1}),(0,s.bF)(n,{class:"change-avatar-btn",small:"",onClick:a[0]||(a[0]=e=>r.showAvatarDialog=!0)},{default:(0,s.k6)(()=>[...a[5]||(a[5]=[(0,s.eW)(" Change Avatar ",-1)])]),_:1})]),_:1})])]),(0,s.Lk)("div",H,[(0,s.bF)(d,{class:"availability-panel"},{default:(0,s.k6)(()=>[a[10]||(a[10]=(0,s.Lk)("h3",{class:"section-title"},"Weekly Availability",-1)),a[11]||(a[11]=(0,s.Lk)("div",{class:"availability-header"},[(0,s.Lk)("span",null,"Day"),(0,s.Lk)("span",null,"Time Range"),(0,s.Lk)("span",null,"Available")],-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.fullWeek,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"availability-row"},[(0,s.Lk)("span",R,(0,u.v_)(e),1),(0,s.Lk)("div",q,[r.availabilityMap[e].available?((0,s.uX)(),(0,s.Wv)(p,{key:0,dense:""},{default:(0,s.k6)(()=>[(0,s.bF)(m,{cols:"6"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:r.availabilityMap[e].start,"onUpdate:modelValue":a=>r.availabilityMap[e].start=a,type:"time",dense:"","hide-details":"",class:"time-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,s.bF)(m,{cols:"6"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:r.availabilityMap[e].end,"onUpdate:modelValue":a=>r.availabilityMap[e].end=a,type:"time",dense:"","hide-details":"",class:"time-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):(0,s.Q3)("",!0),!r.availabilityMap[e].available||r.availabilityMap[e].start||r.availabilityMap[e].end?r.availabilityMap[e].available?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Q," Not available ")):((0,s.uX)(),(0,s.CE)("div",K," ⏳ TBD "))]),(0,s.Lk)("div",Y,[(0,s.bF)(v,{modelValue:r.availabilityMap[e].available,"onUpdate:modelValue":a=>r.availabilityMap[e].available=a,inset:"",color:"success","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])]))),128)),(0,s.Lk)("div",G,[(0,s.bF)(n,{class:"clear-btn",onClick:i.clearWeek,small:""},{default:(0,s.k6)(()=>[...a[7]||(a[7]=[(0,s.eW)("Clear Week",-1)])]),_:1},8,["onClick"]),(0,s.bF)(n,{class:"save-btn",onClick:i.saveAllAvailability,small:""},{default:(0,s.k6)(()=>[...a[8]||(a[8]=[(0,s.eW)("Save All",-1)])]),_:1},8,["onClick"])]),(0,s.bF)(h,{modelValue:r.saveSnackbar,"onUpdate:modelValue":a[1]||(a[1]=e=>r.saveSnackbar=e),timeout:"3000",location:"bottom center",class:"save-snackbar",style:{"background-color":"transparent"}},{default:(0,s.k6)(()=>[...a[9]||(a[9]=[(0,s.eW)(" ✅ Availability saved! ",-1)])]),_:1},8,["modelValue"])]),_:1})])]),(0,s.bF)(w,{modelValue:r.showAvatarDialog,"onUpdate:modelValue":a[3]||(a[3]=e=>r.showAvatarDialog=e),"max-width":"600px",scrollable:""},{default:(0,s.k6)(()=>[(0,s.bF)(d,null,{default:(0,s.k6)(()=>[(0,s.bF)(b,{class:"text-h6"},{default:(0,s.k6)(()=>[...a[12]||(a[12]=[(0,s.eW)("Update Your Avatar",-1)])]),_:1}),(0,s.bF)(g,null,{default:(0,s.k6)(()=>[(0,s.bF)(f,{userId:r.userId,onUpdated:i.handleAvatarUpdate},null,8,["userId","onUpdated"])]),_:1}),(0,s.bF)(k,null,{default:(0,s.k6)(()=>[(0,s.bF)(y),(0,s.bF)(n,{text:"",onClick:a[2]||(a[2]=e=>r.showAvatarDialog=!1)},{default:(0,s.k6)(()=>[...a[13]||(a[13]=[(0,s.eW)("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}t(116);const ae={class:"avatar-editor"},te={key:0,class:"cropper-wrapper"};function le(e,a,t,l,r,i){const o=(0,s.g2)("v-file-input"),n=(0,s.g2)("Cropper"),u=(0,s.g2)("v-btn");return(0,s.uX)(),(0,s.CE)("div",ae,[(0,s.bF)(o,{label:"Choose Image",accept:"image/*",onChange:i.onFileChange,"hide-details":"",outlined:""},null,8,["onChange"]),r.previewUrl?((0,s.uX)(),(0,s.CE)("div",te,[(0,s.bF)(n,{ref:"cropper",src:r.previewUrl,"stencil-props":{aspectRatio:1},"auto-zoom":!1,"resize-image":!0,transformable:!1,class:"cropper"},null,8,["src"]),(0,s.bF)(u,{color:"primary",class:"mt-4",onClick:i.uploadAvatar},{default:(0,s.k6)(()=>[...a[0]||(a[0]=[(0,s.eW)(" Upload Avatar ",-1)])]),_:1},8,["onClick"])])):(0,s.Q3)("",!0)])}var se=t(991);const re=(0,se.UU)("https://heuigzyutypfjpqzipik.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhldWlnenl1dHlwZmpwcXppcGlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0MjA3MTYsImV4cCI6MjA3Mzk5NjcxNn0.DF8fjinfbOSiP6SjWlxo991auPxerIFjr-UicrRys88");async function ie(e,a,t="avatars"){try{const{data:l}=await re.auth.getSession(),s=l?.session?.access_token;if(!s)return console.error("No access token found. User may not be signed in."),null;const r=await fetch(`https://heuigzyutypfjpqzipik.supabase.co/storage/v1/object/${t}/${a}`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"image/png"},body:e});if(!r.ok){const e=await r.text();return console.error("Upload failed:",e),null}const{data:i}=re.storage.from(t).getPublicUrl(a);return i?.publicUrl||null}catch(l){return console.error("Upload error:",l),null}}var oe=t(5059),ne={name:"AvatarEditor",components:{Cropper:oe.IO},props:["userId"],data(){return{previewUrl:null,defaultAvatarUrl:""}},async mounted(){const{data:e}=n.N.storage.from("avatars").getPublicUrl("default-avatar.jpg");this.defaultAvatarUrl=e.publicUrl},methods:{onFileChange(e){const a=e?.target?.files?.[0];if(!a||!a.type?.startsWith("image/"))return void console.error("Invalid file type:",a);const t=new FileReader;t.onload=e=>{this.previewUrl=e.target.result},t.readAsDataURL(a)},async uploadAvatar(){const e=this.$refs.cropper?.getResult()?.canvas;if(!e)return void console.error("No canvas returned from cropper");const a=await new Promise(a=>e.toBlob(a,"image/png")),t=`${this.userId}-${Date.now()}.png`,l=await ie(a,t);if(!l)return void console.error("Upload failed or URL missing");const{error:s}=await n.N.from("profiles").update({avatar_url:l}).eq("id",this.userId);s?console.error("Profile update failed:",s.message):(this.$emit("updated",l),this.previewUrl=null)}}};const ue=(0,m.A)(ne,[["render",le],["__scopeId","data-v-5e67a061"]]);var de=ue,ce={name:"DashboardPage",components:{AvatarEditor:de},data(){return{profile:{},userId:null,avatarUrl:"",defaultAvatar:"",showAvatarDialog:!1,fullWeek:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],userAvailability:[],availabilityMap:Object.fromEntries(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(e=>[e,{available:!1,start:"",end:""}])),saveSnackbar:!1,userTimeZone:Intl.DateTimeFormat().resolvedOptions().timeZone}},async mounted(){const{data:{user:e}}=await n.N.auth.getUser();if(!e)return this.$router.push("/");this.userId=e.id;const{data:a}=n.N.storage.from("avatars").getPublicUrl("default-avatar.jpg");this.defaultAvatar=a.publicUrl;const{data:t,error:l}=await n.N.from("profiles").update({timezone:this.userTimeZone}).eq("id",this.userId).select().single();l?console.error("❌ Failed to load profile:",l.message):(this.profile={...t,email:e.email},this.userTimeZone=t.timezone||this.userTimeZone,this.avatarUrl=t.avatar_url?.trim()?t.avatar_url:this.defaultAvatar),await this.fetchAvailability()},methods:{handleAvatarUpdate(e){this.avatarUrl=e,this.showAvatarDialog=!1},clearWeek(){this.fullWeek.forEach(e=>{this.availabilityMap[e]={available:!1,start:"",end:""}})},convertToUtcTime(e){try{const[a,t]=e.split(":").map(Number),l=new Date;return l.setHours(a,t,0,0),l.toISOString().substring(11,19)}catch(a){return console.warn("⚠️ UTC conversion failed:",a),null}},async fetchAvailability(){const{data:e,error:a}=await n.N.from("availability").select("*").eq("user_id",this.userId);a?console.error("❌ Failed to fetch availability:",a.message):(this.userAvailability=e||[],this.fullWeek.forEach(e=>{const a=this.userAvailability.find(a=>a.day===e);if(a&&(this.availabilityMap[e].available="Available"===a.status,a.start_time&&a.end_time))try{const t=(new Date).toISOString().split("T")[0],l=new Date(`${t}T${a.start_time}Z`),s=new Date(`${t}T${a.end_time}Z`);this.availabilityMap[e].start=l.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",timeZone:this.userTimeZone}),this.availabilityMap[e].end=s.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",timeZone:this.userTimeZone})}catch(t){console.warn(`⚠️ Failed to format time for ${e}:`,t)}}))},async saveAllAvailability(){for(const e of this.fullWeek){const{available:a,start:t,end:l}=this.availabilityMap[e],s=e=>/^\d{2}:\d{2}$/.test(e);let r="Unavailable",i=null,o=null;a&&s(t)&&s(l)&&(i=this.convertToUtcTime(t),o=this.convertToUtcTime(l),r="Available");const u=this.userAvailability.find(a=>a.day===e);if(u){const{error:a}=await n.N.from("availability").update({start_time:i,end_time:o,status:r}).eq("id",u.id);a&&console.error(`❌ Update failed for ${e}:`,a)}else{const{data:a,error:t}=await n.N.from("availability").insert([{user_id:this.userId,name:this.profile.username,day:e,start_time:i,end_time:o,status:r}]);t?console.error(`❌ Insert failed for ${e}:`,t):this.userAvailability.push(...a)}}await this.fetchAvailability(),this.saveSnackbar=!0}}};const me=(0,m.A)(ce,[["render",ee],["__scopeId","data-v-727fd5b2"]]);var pe=me;const ve=[{path:"/",component:T},{path:"/calendar",component:D},{path:"/dashboard",component:pe},{path:"/games",component:()=>t.e(997).then(t.bind(t,5997))}],he=(0,U.aE)({history:(0,U.LA)(),routes:ve});var be=he,fe=t(5850),ge=t(1671),ye=t(1357),ke=(0,fe.$N)({components:ge,directives:ye,theme:{defaultTheme:"dark",themes:{dark:{dark:!0,colors:{background:"#0f172a",surface:"#1e293b",primary:"#fff1e6",secondary:"#f5e1da",accent:"#cdb4db",info:"#a3c4f3",success:"#b5ead7",warning:"#ffd6a5",error:"#ff6b6b"}}}}});t(5524);const we=(0,l.Ef)(w);we.use(be),we.use(ke),we.mount("#app"),window.supabase=n.N}},a={};function t(l){var s=a[l];if(void 0!==s)return s.exports;var r=a[l]={exports:{}};return e[l].call(r.exports,r,r.exports,t),r.exports}t.m=e,function(){var e=[];t.O=function(a,l,s,r){if(!l){var i=1/0;for(d=0;d<e.length;d++){l=e[d][0],s=e[d][1],r=e[d][2];for(var o=!0,n=0;n<l.length;n++)(!1&r||i>=r)&&Object.keys(t.O).every(function(e){return t.O[e](l[n])})?l.splice(n--,1):(o=!1,r<i&&(i=r));if(o){e.splice(d--,1);var u=s();void 0!==u&&(a=u)}}return a}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[l,s,r]}}(),function(){t.d=function(e,a){for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}}(),function(){t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce(function(a,l){return t.f[l](e,a),a},[]))}}(),function(){t.u=function(e){return"js/"+e+".6c1923f2.js"}}(),function(){t.miniCssF=function(e){return"css/"+e+".1feb54af.css"}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){var e={},a="MilkSync:";t.l=function(l,s,r,i){if(e[l])e[l].push(s);else{var o,n;if(void 0!==r)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d];if(c.getAttribute("src")==l||c.getAttribute("data-webpack")==a+r){o=c;break}}o||(n=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,t.nc&&o.setAttribute("nonce",t.nc),o.setAttribute("data-webpack",a+r),o.src=l),e[l]=[s];var m=function(a,t){o.onerror=o.onload=null,clearTimeout(p);var s=e[l];if(delete e[l],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach(function(e){return e(t)}),a)return a(t)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),n&&document.head.appendChild(o)}}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/milksync/"}(),function(){if("undefined"!==typeof document){var e=function(e,a,l,s,r){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",t.nc&&(i.nonce=t.nc);var o=function(t){if(i.onerror=i.onload=null,"load"===t.type)s();else{var l=t&&t.type,o=t&&t.target&&t.target.href||a,n=new Error("Loading CSS chunk "+e+" failed.\n("+l+": "+o+")");n.name="ChunkLoadError",n.code="CSS_CHUNK_LOAD_FAILED",n.type=l,n.request=o,i.parentNode&&i.parentNode.removeChild(i),r(n)}};return i.onerror=i.onload=o,i.href=a,l?l.parentNode.insertBefore(i,l.nextSibling):document.head.appendChild(i),i},a=function(e,a){for(var t=document.getElementsByTagName("link"),l=0;l<t.length;l++){var s=t[l],r=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(r===e||r===a))return s}var i=document.getElementsByTagName("style");for(l=0;l<i.length;l++){s=i[l],r=s.getAttribute("data-href");if(r===e||r===a)return s}},l=function(l){return new Promise(function(s,r){var i=t.miniCssF(l),o=t.p+i;if(a(i,o))return s();e(l,o,null,s,r)})},s={524:0};t.f.miniCss=function(e,a){var t={997:1};s[e]?a.push(s[e]):0!==s[e]&&t[e]&&a.push(s[e]=l(e).then(function(){s[e]=0},function(a){throw delete s[e],a}))}}}(),function(){var e={524:0};t.f.j=function(a,l){var s=t.o(e,a)?e[a]:void 0;if(0!==s)if(s)l.push(s[2]);else{var r=new Promise(function(t,l){s=e[a]=[t,l]});l.push(s[2]=r);var i=t.p+t.u(a),o=new Error,n=function(l){if(t.o(e,a)&&(s=e[a],0!==s&&(e[a]=void 0),s)){var r=l&&("load"===l.type?"missing":l.type),i=l&&l.target&&l.target.src;o.message="Loading chunk "+a+" failed.\n("+r+": "+i+")",o.name="ChunkLoadError",o.type=r,o.request=i,s[1](o)}};t.l(i,n,"chunk-"+a,a)}},t.O.j=function(a){return 0===e[a]};var a=function(a,l){var s,r,i=l[0],o=l[1],n=l[2],u=0;if(i.some(function(a){return 0!==e[a]})){for(s in o)t.o(o,s)&&(t.m[s]=o[s]);if(n)var d=n(t)}for(a&&a(l);u<i.length;u++)r=i[u],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(d)},l=self["webpackChunkMilkSync"]=self["webpackChunkMilkSync"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))}();var l=t.O(void 0,[504],function(){return t(8867)});l=t.O(l)})();
//# sourceMappingURL=app.775cc843.js.map